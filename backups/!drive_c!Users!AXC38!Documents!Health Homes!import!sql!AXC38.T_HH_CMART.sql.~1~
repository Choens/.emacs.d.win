-- =============================================================================
-- 
-- =============================================================================
--------------------------------------------------------
--  DDL for Table T_HH_TMP
--------------------------------------------------------

DROP TABLE AXC38.T_HH_CMART ;
commit;

CREATE TABLE AXC38.T_HH_CMART
 (
	PLAN_ID          VARCHAR2(255 BYTE), 
	HH_ID            VARCHAR2(8), 
	HH_ID_N          INT, 
    HH_NAME          VARCHAR(50 BYTE),
	REPORT_DATE      VARCHAR2(255 BYTE), 
	CIN              VARCHAR2(255 BYTE), 
	LAST_NAME        VARCHAR2(255 BYTE), 
	FIRST_NAME       VARCHAR2(255 BYTE), 
	DOB              DATE, 
	TRIGGER_DATE     DATE, 
	PROGRAM_TYPE     VARCHAR2(255 BYTE), 
	ABLE_CONTACT     VARCHAR2(255 BYTE), 
	CONTACT_DATE     DATE, 
	OUTREACH_EFFORT  BINARY_DOUBLE, 
	APPROPRIATE_CM   VARCHAR2(255 BYTE), 
	ASSESSED_CM      VARCHAR2(255 BYTE), 
	ASSESS_DATE      DATE, 
	OPT_OUT          VARCHAR2(255 BYTE), 
	ENGAGED_CM       VARCHAR2(255 BYTE), 
	ENGAGE_CM_DATE   DATE, 
	CONSENT_DATE     DATE, 
	INTENSITY        VARCHAR2(255 BYTE), 
	COUNT_MAIL       BINARY_DOUBLE, 
	COUNT_PHONE      BINARY_DOUBLE, 
	COUNT_PERSON     BINARY_DOUBLE, 
	CASE_CLOSED      VARCHAR2(255 BYTE), 
	CLOSURE_DATE     DATE, 
	REASON_CLOSURE   VARCHAR2(255 BYTE), 
	CASE_REOPENED    VARCHAR2(255 BYTE), 
	DATE_REOPENED    BINARY_DOUBLE, 
	PLAN_UPDATE      VARCHAR2(255 BYTE), 
	CARE_MANAGE      BINARY_DOUBLE, 
	HEALTH_PROMOTE   BINARY_DOUBLE, 
	TRANSITION_CARE  BINARY_DOUBLE, 
	MEMBER_SUPPORT   BINARY_DOUBLE, 
	COMM_SOCIAL      BINARY_DOUBLE, 
	DATE_FACT_HH     DATE, 
	REASON_FACT_HH   VARCHAR2(255 BYTE), 
	PWB              BINARY_DOUBLE, 
	SWB              BINARY_DOUBLE, 
	EWB              BINARY_DOUBLE, 
	FWB              BINARY_DOUBLE, 
	FACT_GP          BINARY_DOUBLE, 
	HH1              BINARY_DOUBLE, 
	HH2              BINARY_DOUBLE, 
	HH3              BINARY_DOUBLE, 
	HH4              BINARY_DOUBLE, 
	HH5              BINARY_DOUBLE, 
	HH6              BINARY_DOUBLE, 
	HH_SUBSCALE      BINARY_DOUBLE, 
	HH_FACT_GP       BINARY_DOUBLE
   )
  SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 
  PCTUSED 40
  INITRANS 1
  MAXTRANS 255
  NOCOMPRESS
  NOLOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPOOL1" ;

--------------------------------------------------------
--  DDL for Index T_HH_CMART_HH_ID
--------------------------------------------------------

  CREATE INDEX "AXC38"."T_HH_CMART_HH_ID" ON "AXC38"."T_HH_CMART" ("HH_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 NOLOGGING COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPOOL1" ;
--------------------------------------------------------
--  DDL for Index T_HH_CMART_CIN
--------------------------------------------------------

  CREATE INDEX "AXC38"."T_HH_CMART_CIN" ON "AXC38"."T_HH_CMART" ("CIN") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 NOLOGGING COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPOOL1" ;
--------------------------------------------------------
--  DDL for Index T_HH_CMART_REPORT_DATE
--------------------------------------------------------

  CREATE INDEX "AXC38"."T_HH_CMART_REPORT_DATE" ON "AXC38"."T_HH_CMART" ("REPORT_DATE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 NOLOGGING COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPOOL1" ;

commit;

grant all privileges on axc38.t_hh_cmart to CXH21;
grant all privileges on axc38.t_hh_cmart to SXA04;
grant all privileges on axc38.t_hh_cmart to ALP04;
commit;


insert /*+ append */ into AXC38.T_HH_CMART 
select distinct
    PLAN_ID
    ,case when length(  cast(cast(tht.HH_ID as int) as varchar(8) ) ) = 5
          then '000' || cast(cast(tht.HH_ID as int) as varchar(8) )
          when length(  cast(cast(tht.HH_ID as int) as varchar(8) ) ) = 6
          then '00' ||  cast(cast(tht.HH_ID as int) as varchar(8) )
          when length(  cast(cast(tht.HH_ID as int) as varchar(8) ) ) = 7
          then '0' ||   cast(cast(tht.HH_ID as int) as varchar(8) )
          when length(  cast( cast(tht.HH_ID as int) as varchar(8) ) ) = 8
          then          cast(cast(tht.HH_ID as int) as varchar(8) )
          else 'Error'
     end HH_ID
    ,cast(HH_ID as int) HH_ID_N
    ,health_home_program_name PROGRAM_NAME
    ,tht.REPORT_DATE
    ,tht.CIN
    ,tht.LAST_NAME
    ,tht.FIRST_NAME
    ,tht.DOB
    ,tht.TRIGGER_DATE
    ,tht.PROGRAM_TYPE
    ,tht.ABLE_CONTACT
    ,tht.CONTACT_DATE
    ,tht.OUTREACH_EFFORT
    ,tht.APPROPRIATE_CM
    ,tht.ASSESSED_CM
    ,tht.ASSESS_DATE
    ,tht.OPT_OUT
    ,tht.ENGAGED_CM
    ,tht.ENGAGE_CM_DATE
    ,tht.CONSENT_DATE
    ,tht.INTENSITY
    ,tht.COUNT_MAIL
    ,tht.COUNT_PHONE
    ,tht.COUNT_PERSON
    ,tht.CASE_CLOSED
    ,tht.CLOSURE_DATE
    ,tht.REASON_CLOSURE
    ,tht.CASE_REOPENED
    ,tht.DATE_REOPENED
    ,tht.PLAN_UPDATE
    ,tht.CARE_MANAGE
    ,tht.HEALTH_PROMOTE
    ,tht.TRANSITION_CARE
    ,tht.MEMBER_SUPPORT
    ,tht.COMM_SOCIAL
    ,tht.DATE_FACT_HH
    ,tht.REASON_FACT_HH
    ,tht.PWB
    ,tht.SWB
    ,tht.EWB
    ,tht.FWB
    ,tht.FACT_GP
    ,tht.HH1
    ,tht.HH2
    ,tht.HH3
    ,tht.HH4
    ,tht.HH5
    ,tht.HH6
    ,tht.HH_SUBSCALE
    ,tht.HH_FACT_GP
from AXC38.T_HH_TMP tht 
    left join hhweb.hh_health_homes hhh
    on tht.hh_id = cast( hhh.health_home_mmis_id  as int)
;

commit;
