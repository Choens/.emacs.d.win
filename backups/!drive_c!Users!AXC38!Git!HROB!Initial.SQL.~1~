
select
    t2011.SUBMISSION_YEAR
    ,t2011.CIN
--    ,t2011.CINPLAN
    ,t2011.DOB
    ,t2011.TRIGGERDATE
    ,t2011.ENROLLEDCM
    ,t2011.ENROLLCMDATE
    ,t2010.ENROLLCMDATE   ENROLLCMDATE2010
    ,t2011.CLOSED
    ,t2011.CLOSUREDATE
--    ,t2011.REASON
--    ,t2011.REGION
--    ,t2011.PLANID1
--    ,t2011.MOMCIN
--    ,t2011.PAYER
--    ,t2011.PLANNAME
--    ,t2011.CERTNO
    ,t2011.IBDATE
--    ,t2011.DPLURAL
--    ,t2011.NEOCARE
--   ,t2011.LBW
--    ,t2011.VLBW
--    ,t2011.CSECTION
--    ,t2011.PRETERM
--    ,t2011.HIGHRSK
--    ,t2011.HOSPPREG2
--    ,t2011.GEST_WEEK
--    ,t2011.CAL_GEST_DAY
--    ,t2011.LAST_MENSES
--    ,t2011.FIRST_VISIT
--    ,t2011.VPFI
from ( select * from axc38.t_prenatal where submission_year = 2011 ) t2011
    left join ( select * from axc38.t_prenatal where submission_year = 2010 ) t2010
    on t2011.cin = t2010.cin
       and t2011.dob = t2010.dob
       and t2011.triggerdate = t2010.triggerdate
       and t2011.planid1 = t2010.planid1
where t2010.ENROLLCMDATE is not null
;



select
    t2011.SUBMISSION_YEAR
    ,t2011.CIN
    --,t2011.CINPLAN
    --,t2011.DOB
    ,t2011.TRIGGERDATE
    ,t2011.ENROLLEDCM
    ,t2011.ENROLLCMDATE
    ,max(t2010.ENROLLCMDATE) ENROLLCMDATE2010
--    ,case when to_date(t2011.ibdate) - max(to_date(t2010.enrollcmdate)) > 30.4375*10 then 'More than 10 months'
--          when to_date(t2011.ibdate) < max(to_date(t2010.enrollcmdate)) then 'Something is badly wrong'
--          else 'Seems plausible'
--     end LOGICAL
    ,t2011.CLOSED
    ,t2011.CLOSUREDATE
    --,t2011.REASON
    --,t2011.REGION
    --,t2011.PLANID1
    --,t2011.MOMCIN
    --,t2011.PAYER
    --,t2011.PLANNAME
    --,t2011.CERTNO
    ,t2011.IBDATE
    --,t2011.DPLURAL
    --,t2011.NEOCARE
    --,t2011.LBW
    --,t2011.VLBW
    --,t2011.CSECTION
    --,t2011.PRETERM
    --,t2011.HIGHRSK
    --,t2011.HOSPPREG2
    --,t2011.GEST_WEEK
    --,t2011.CAL_GEST_DAY
    --,t2011.LAST_MENSES
    --,t2011.FIRST_VISIT
    --,t2011.VPFI
from ( select * from axc38.t_prenatal where submission_year = 2011 ) t2011
    left join ( select * from axc38.t_prenatal where submission_year = 2010 ) t2010
    on t2011.cin = t2010.cin
       and t2011.dob = t2010.dob
       --and t2011.triggerdate = t2010.triggerdate
       --and t2011.planid1 = t2010.planid1
where t2010.ENROLLCMDATE is not null
group by
    t2011.SUBMISSION_YEAR
    ,t2011.CIN
    --,t2011.CINPLAN
    --,t2011.DOB
    ,t2011.TRIGGERDATE
    ,t2011.ENROLLEDCM
    ,t2011.ENROLLCMDATE
    ,t2011.CLOSED
    ,t2011.CLOSUREDATE
    --,t2011.REASON
    --,t2011.REGION
    --,t2011.PLANID1
    --,t2011.MOMCIN
    --,t2011.PAYER
    --,t2011.PLANNAME
    --,t2011.CERTNO
    ,t2011.IBDATE
    --,t2011.DPLURAL
    --,t2011.NEOCARE
    --,t2011.LBW
    --,t2011.VLBW
    --,t2011.CSECTION
    --,t2011.PRETERM
    --,t2011.HIGHRSK
    --,t2011.HOSPPREG2
    --,t2011.GEST_WEEK
    --,t2011.CAL_GEST_DAY
    --,t2011.LAST_MENSES
    --,t2011.FIRST_VISIT
    --,t2011.VPFI
;


select * from axc38.t_prenatal where submission_year = 2011 ;
select * from axc38.t_prenatal where submission_year = 2010 ;


select *
from (
       select
           t2010.SUBMISSION_YEAR
           ,t2010.CIN
           ,t2010.DOB
           ,t2010.TRIGGERDATE
           ,t2010.ENROLLEDCM
           ,t2010.ENROLLCMDATE
           ,t2010.CLOSED
           ,t2010.CLOSUREDATE
           ,t2010.REASON
           ,t2010.REGION
           ,t2010.IBDATE
       from ( select * from axc38.t_prenatal where submission_year = 2011 ) t2011
           inner join ( select * from axc38.t_prenatal where submission_year = 2010 ) t2010
           on t2011.cin = t2010.cin
              and t2011.dob = t2010.dob
              --and t2011.triggerdate = t2010.triggerdate
              --and t2011.planid1 = t2010.planid1
       where t2010.ENROLLCMDATE is not null
       union
       select
           t2011.SUBMISSION_YEAR
           ,t2011.CIN
           ,t2011.DOB
           ,t2011.TRIGGERDATE
           ,t2011.ENROLLEDCM
           ,t2011.ENROLLCMDATE
           ,t2011.CLOSED
           ,t2011.CLOSUREDATE
           ,t2011.REASON
           ,t2011.REGION
           ,t2011.IBDATE
       from ( select * from axc38.t_prenatal where submission_year = 2011 ) t2011
           inner join ( select * from axc38.t_prenatal where submission_year = 2010 ) t2010
           on t2011.cin = t2010.cin
              and t2011.dob = t2010.dob
              --and t2011.triggerdate = t2010.triggerdate
              --and t2011.planid1 = t2010.planid1
       where t2010.ENROLLCMDATE is not null
     ) src0
order by cin, triggerdate
;
